{% extends "sidebarU.html" %}

{% block styles %}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* General styles */
        .head-title {
          margin-bottom: 20px;
         
        }
      
      
      
      
        .head-title h1 {
          font-weight: bold;
          font-size: 35px;
          margin: 0 0 25px 20px;
          color: rgb(23, 23, 88);
        }
      
      
      
      
        .table-container {
          max-width: 100vw; /* Width for the tables */
          margin: auto; /* Center the tables */
          margin-bottom: 40px; /* Space between tables */
          border-radius: 5px; /* Rounded corners */
          padding: 20px; /* Inner spacing */
          height: auto;
          min-height: 380px;
          box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.1); /* Subtle shadow */
          background-color: transparent; /* White background */
          margin-top: 20px;
          overflow-x: auto;
      }
      
      
      
        
        .card-container1 {
          display: flex;
          gap: 20px;
          margin-top: 12px;
          flex-wrap: wrap;
          margin-left: 20px;
        }
      
      
      
        .card:hover {
          transform: translateY(-3px);
          border: 2px solid rgba(255, 255, 255, 0.3);
        }
      
      
      
      
        .total-complaints { background-color: #2f3d4c; }
        .in-progress { background-color: #967c2e; }
        .done { background-color: #011004; }
        .overdue { background-color: #310408; }
        .resolveoverdue { background-color: #b34b0f; }
      
      
      
      
        table {
          width: 10%;
          border-collapse: collapse;
          margin-top: 10px;
      }
      
      
      
      
      
      th, td {
        padding: 10px;
        text-align: left;
      }
      
      
      
      
      th {
        background-color: white; /* Light gray for header */
        color: #333; /* Dark text for better readability */
        font-weight: bold;
      }
      
      
      
      
      
        tbody tr:hover {
          background-color: #f1f1f1;
        }
      
      
      
      
        h2{
            margin-left: 30px;
            margin-bottom: 15px;
            font-size: 30px;
            margin-top: -27px;
        }
      
      
      
      
        /* Pagination */
        .pagination {
          display: flex;
          justify-content: flex-end;
          align-items: center;
          margin-top: 10px;
        }
      
      
      
      
        .pagination button {
          padding: 8px 16px;
          border: none;
          background-color: #007BFF;
          color: white;
          cursor: pointer;
          margin-left: 5px;
        }
      
      
      
      
        .pagination button:disabled {
          background-color: #007BFF;
          cursor: not-allowed;
        }
      
      
      
      
        #pageInfo {
          margin: 0 10px;
        }
      
      
      
      
       /* Header styling */
       .header-container {
        display: flex;
        justify-content: space-between; /* Space between elements */
        align-items: center;
        margin-bottom: 20px;
        margin-top: 20px;
      }
      
      
      
      
        .title-filter-container h2 {
          margin: 0; /* Remove default margin */
        }
      
      
      
      
        h1 {
            font-weight: bold;
            font-size: 35px;
            margin: 50px 0;
            margin-bottom: 20px;
            margin-left: -70%;
            font-family: 'Times New Roman';
        }
 
        .filter-form {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            width: 100%;
        }
 
        /* Layout for the filter rows */
        .filter-row {
            display: flex;
            justify-content: flex-start;
            flex-wrap: wrap;
            width: 85%;
            margin-bottom: 20px;
            margin-left: 30px;
        }
 
        /* Ensure each filter item takes up the same space */
        .filter-item {
            flex: 1 1 100px; /* Adjusted flex property to ensure all items fit */
            margin-right: 10px; /* Add some space between items */
        }
 
        .filter-item:last-child {
            margin-right: 0; /* Remove right margin from last filter item */
        }
 

 
        /* Adjust the label styles */
        label {
            font-size: 15px;
            font-weight: bold;
            margin-bottom: 5px;
            display: block;
        }

        /* Styling for input and select elements */
        input[type="date"],input[type="text"], select {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            border: 2px solid #ccc;
            border-radius: 1px;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }

        input[type="date"]:focus, select:focus {
            border-color: #007bff;
            outline: none;
        }

        input[type="date"]:hover, select:hover {
            border-color: #007bff;
        }

 
        .icon {
            font-size: 150px;
            color: #0e3152;
            margin: 20px 0;
        }
 
/* Button styles */
button[type="submit"] {
    padding: 11px 20px;
    background-color: #0e3457;
    color: white;
    border: none;
    border-radius: 5px;
    font-size: 16px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    align-self: center;
    margin-top: -60px; /* Adjust margin-top to create spacing from filters */
    margin-left: auto; /* Push button to the right */
    margin-right: 30px; /* Ensure it's not floating left */
    position: relative; /* Make position relative to its container */
    width: auto;
    max-width: 200px; /* Limit the button width if needed */
}

 
        button[type="submit"]:hover {
            background-color: #0056b3;
        }

        button[type="button"] {
            padding: 11px 25px;
            background-color: #0e3457;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            align-self: center;
            margin-top: 24px; /* Adjust margin-top to create spacing from filters */
            margin-left: auto; /* Push button to the right */
            margin-right: -1080px; /* Ensure it's not floating left */
            position: absolute; /* Make position relative to its container */
            width: auto;
            max-width: 200px; /* Limit the button width if needed */
        }
        
         
                button[type="button"]:hover {
                    background-color: #0056b3;
                }

      
      /* Example color coding for statuses */
      .status-pending {
        color: #FF8C00; /* Orange for Pending */
        font-weight: bold;
      }
      
      
      
      .status-progress {
        color: #8a7605d0; /* Golden Yellow for Work in Progress */
        font-weight: bold;
      }
      
      
      
      .status-overdue {
        color: #FF4500; /* Red for Overdue */
        font-weight: bold;
      }
      
      
      
      .status-resolved {
        color: #32CD32; /* Green for Resolved */
        font-weight: bold;
      }
      
      
      
      .sort-indicator {
        position: absolute;
        right: 10px; /* Space from the right edge */
        top: 50%;
        transform: translateY(-50%); /* Vertically center the icon */
        cursor: pointer;
        display: inline-block; /* Ensure icon aligns properly with text */
      }
      
      
      
      
      th span {
        margin-right: 5px; /* Add some space between the heading text and icon */
       
      }
      
      
      
      
      .main {
              padding: 10px;
              background: transparent;
              display: grid;
              grid-template-columns: repeat(3, 1fr); 
              gap: 10px;
              min-height: 10vh;
          }
      
      
      
          .card {
              background-color: transparent;
              padding: 10px;
              border-radius: 10px;
              box-shadow: 0 2px 10px rgba(0, 0, 0, 0.03);
              text-align: center;
              display: flex;
              flex-direction: column;
              justify-content: center;
              align-items: center;
          }
      
      
      
          .card h2 {
              font-size: 14px;
              color: #000000;
              margin-bottom: 10px;
              font-weight: 20px;
              font-size: medium;
          }
      
      
      
          .card canvas {
              max-width: 250px;
              max-height: 350px;
          }
      
      
      
          .large-card-container {
              display: grid;
              grid-template-columns: repeat(2, 1fr); 
              margin-top: 20px;
          }
      
      
      
         
          .large-card {
              width: 500px;  
              height: 400px; 
              margin-bottom: 20px; 
              margin-left: 10px;
          }
      
      
      
          .large-card canvas{
            max-width: 550px;
            max-height: 650px;
          }
      
          
      
      
         
/* Media query for responsiveness */
@media (max-width: 1024px) { /* For laptops and smaller screens */
    .filter-form {
        flex-direction: column; /* Stack elements vertically */
        align-items: flex-start; /* Align elements to the left */
    }

    button[type="submit"] {
        margin-left: 0; /* Remove large margin for smaller screens */
        width: 100%; /* Make button full width */
        text-align: center;
        margin-top: -5px; /* Move button slightly up for smaller screens */
    }
}
      
      
      
          .large-card-container {
              grid-template-columns: 1fr;
          }
      
      
      /* Custom CSS to modify the placement of the "Display records per page" text */
div.dataTables_length {
    display: flex;
    flex-direction: column; /* Stack elements vertically */
    align-items: flex-start; /* Align text and dropdown to the left */
}


/* Reduce the width of the "Display records per page" dropdown */
div.dataTables_length select {
    width: 50px; /* Adjust the width as needed */
    max-width: 100%; /* Ensure it doesn't overflow */
    margin-left: 10px;
}
      
      /* .head-title h1 {
        border-bottom: 2px solid #000000;  
        padding-bottom: 10px;  
      } */
      </style>
{% endblock %}

{% block content %}
<h2>Search Complaints</h2>

    <div class="report-container">
        <form class="filter-form" action="{% url 'usercomplaintsearch' %}" method="get">
             <!-- Date Filters -->
        <div class="filter-row">
            <div class="filter-item">
                <label for="from_date">From:</label>
                <input type="date" id="from_date" name="fromdate" value="{{ filter_params.fromdate }}">
            </div>
            <div class="filter-item">
                <label for="to_date">To:</label>
                <input type="date" id="to_date" name="todate" value="{{ filter_params.todate }}">
            </div>
        </div>
            <div class="filter-row">
                <div class="filter-item">
                    <label for="complaint_id">Complaint No:</label>
                    <input type="text" id="complaint_id" name="complaint_id" placeholder="Enter complaint Nos" value="{{ filter_params.complaint_id }}">
                </div>
                <div class="filter-item">
                    <label for="status">Status:</label>
                    <select id="status" name="status">
                        <option value="">Select Status</option>
                        {% for status_item in statuses %}
                        <option value="{{ status_item }}" {% if status_item == filter_params.status %}selected{% endif %}>{{ status_item }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="filter-item">
                    <label for="location">Location:</label>
                    <select id="location" name="location">
                        <option value="">Select Location</option>
                        {% for loc in distinct_locations %}
                        <option value="{{ loc }}" {% if loc == filter_params.location %}selected{% endif %}>{{ loc }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="filter-item">
                    <label for="department">Department:</label>
                    <select id="department" name="department">
                        <option value="">Select Department</option>
                        {% for dept in distinct_departments %}
                        <option value="{{ dept }}" {% if dept == filter_params.department %}selected{% endif %}>{{ dept }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="filter-item">
                    <label for="complaint_type">Complaint Type:</label>
                    <select id="complaint_type" name="complaint_type">
                        <option value="">Select Complaint Type</option>
                        {% for ctype in distinct_complaint_types %}
                        <option value="{{ ctype }}" {% if ctype == filter_params.complaint_type %}selected{% endif %}>{{ ctype }}</option>
                    {% endfor %}
                    </select>
                </div>

            </div>
        <button type="submit">Search</button>
        <!-- <button type="button" onclick="clearFilters()">Clear</button> -->
        </form>
    </div>

<div class="table-container">
    <div class="table-responsive">
    <table id="complaintsTable" class="display">
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Dept</th>
                <th>Location</th>
                <th>Description</th>
                <th>Type</th>
                <th>Raised On</th>
                <th>Due Date</th>
                <th>Updated Due Date</th>
                <th>Reason</th>
                <th>Status</th>
                <th>Resolution Time</th>
            </tr>
        </thead>
        <tbody>
            {% for complaint in complaints %}
            <tr>
                <td>{{ complaint.id }}</td>
                <td>{{ complaint.name }}</td> <!-- Name -->
                <td>{{ complaint.department }}</td> <!-- Department -->
                <td>{{ complaint.location }}</td> <!-- Location -->
                <td>{{ complaint.description }}</td> <!-- Description -->
                <td>{{ complaint.complaint_type }}</td> <!-- Complaint Type -->
                <td>{{ complaint.date }}</td> <!-- Issue Date -->
                <td>{{ complaint.due_date }}</td> <!-- Due Date -->
                <td>{{ complaint.updated_due_date }}</td> <!-- Updated Due Date -->
                <td>{{ complaint.reason }}</td> <!-- Reason -->
                <td>
                    <span class="{% if complaint.status|lower == 'pending' %}status-pending
                                  {% elif complaint.status|lower == 'work in progress' %}status-progress
                                  {% elif complaint.status|lower == 'overdue' %}status-overdue
                                  {% elif complaint.status|lower == 'resolved' %}status-resolved{% endif %}">
                        {% if complaint.status|lower == 'pending' %}
                            <i class="fas fa-clock"></i> <!-- Pending icon -->
                        {% elif complaint.status|lower == 'work in progress' %}
                            <i class="fas fa-spinner"></i> <!-- Work in Progress icon -->
                        {% elif complaint.status|lower == 'overdue' %}
                            <i class="fas fa-exclamation-triangle"></i> <!-- Overdue icon -->
                        {% elif complaint.status|lower == 'resolved' %}
                            <i class="fas fa-check-circle"></i> <!-- Resolved icon -->
                        {% endif %}
                        <strong>{{ complaint.status }}</strong>
                    </span>
                </td> <!-- Status -->
                <td>{{ complaint.tat }}</td> <!-- TAT -->
            </tr>
            {% endfor %}
        </tbody>
    </table>
    </div>
</div>
{% endblock %}

{% block scripts %}
    <!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- DataTables JS -->
<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>

<!-- DataTables CSS -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">

<!-- DataTables Buttons CSS -->
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.3.6/css/buttons.dataTables.min.css">

<!-- DataTables Buttons JS -->
<script src="https://cdn.datatables.net/buttons/2.3.6/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.print.min.js"></script>

<!-- JSZip for Excel export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

<!-- PDFMake for PDF export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.68/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.68/vfs_fonts.js"></script>

<script>
    $(document).ready(function () {
      // Initialize DataTables for complaintTable
      $('#complaintsTable').DataTable({
          paging: true,
          searching: true,
          ordering: true,
          responsive: true,
          lengthMenu: [5, 10, 25, 50],
          columnDefs: [
              { orderable: false, targets: -1 }
          ],
          language: {
              search: "Search:",
              lengthMenu: " Records per page_MENU_",
              zeroRecords: "No complaints found",
              info: "Showing _START_ to _END_ of _TOTAL_ complaints",
              infoEmpty: "No records available",
              paginate: {
                  previous: "Previous",
                  next: "Next"
              }
          },
          
          initComplete: function() {
              // Apply custom CSS styles to move the search box label and input up
              $('#complaintsTable_filter label').css({
                  'position': 'relative',
                  'top': '-8px',  // Adjust the value as needed to move the search box up
                  'left': '0'
              });
              $('#complaintsTable_filter input').css({
                  'position': 'relative',
                  'top': '-3px'  // Adjust the value as needed to move the search box up
              });
          }
      });
    });
  </script>
  
  <script type="text/javascript">
    // This script will force a redirect to login if the user navigates back
    if (!sessionStorage.getItem('loggedIn')) {
      window.location.href = "{% url 'login' %}";
    }
  </script>

  <script>
    // JavaScript function to clear all filters and refresh the page
    function clearFilters() {
        // Clear all filter fields
        document.getElementById('from_date').value = '';
        document.getElementById('to_date').value = '';
        document.getElementById('location').value = '';
        document.getElementById('department').value = '';
        document.getElementById('complaint_type').value = '';
        document.getElementById('status').value = '';
        document.getElementById('complaint_id').value = '';

        // Redirect to the complaintsearch URL to refresh the page
        //window.location.href = '/usercomplaintsearch/';
    }
</script>
{% endblock %}
